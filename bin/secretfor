#!/usr/bin/env ruby

people = {
  "will" => "will@kiwinet.org",
  "claude" => "claude.modderman@fairfaxmedia.co.nz"
}
sender_email = "eoin@rabidtech.co.nz"

# gather recipients
recipients = []

def pretty_print(people)
  people.each do |nick, email|
    puts " * #{nick}\t#{email}"
  end
end
if ARGV.empty?
  puts "Available people:"
  pretty_print(people)
  print "Enter person: "
  recipients << STDIN.gets.chomp
else
  recipients += ARGV
end

recipient_list = "--recipient #{sender_email} "
recipient_list += recipients.map { |name| "--recipient #{people[name]}" }.join(" ")

# gather message
eom = "END"
puts "Enter your message for #{recipients} (type #{eom} to finish):"
msg = STDIN.gets(eom).chomp(eom)

cipher = `echo "#{msg}" | gpg --encrypt --armor #{recipient_list}`
puts cipher
